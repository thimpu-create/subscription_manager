{% extends 'dash_base.html' %}

{% block dashboard_content %}
<div class="max-w-7xl mx-auto px-4 py-6">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-semibold text-gray-900">Settings</h1>
    <p class="text-sm text-gray-500">Manage your subscription management preferences and configurations</p>
  </div>

  <div class="bg-white rounded-lg shadow">
    <!-- Tabs Header -->
    <div class="border-b border-gray-200">
      <nav class="flex -mb-px">
        <button class="tab-btn whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm border-blue-500 text-blue-600" data-tab="account">
          <i class="far fa-user-circle mr-2"></i>Account
        </button>
        <button class="tab-btn whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="billing">
          <i class="far fa-credit-card mr-2"></i>Billing & Invoicing
        </button>
        <button class="tab-btn whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="notifications">
          <i class="far fa-bell mr-2"></i>Notifications
        </button>
        <button class="tab-btn whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="integrations">
          <i class="fas fa-plug mr-2"></i>Integrations
        </button>
        <button class="tab-btn whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="advanced">
          <i class="fas fa-sliders-h mr-2"></i>Advanced
        </button>
      </nav>
    </div>

    <!-- Tab Contents -->
    <div class="p-6">
      <!-- Account Settings -->
      <div id="account" class="tab-content">
        <div class="space-y-6">
          <!-- Profile Section -->
          <section class="bg-white">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-medium text-gray-900">Profile Information</h3>
              <span class="text-xs text-gray-500">Date joined: {{ request.user.date_joined }}</span>
            </div>
            <div class="grid grid-cols-6 gap-6">
              <!-- Profile Picture -->
              <div class="col-span-6 sm:col-span-2">
                <div class="flex items-center space-x-4">
                  <img src="https://ui-avatars.com/api/?name=John+Doe" class="h-16 w-16 rounded-full">
                  <button class="text-sm text-blue-600 hover:text-blue-700">Change</button>
                </div>
              </div>
              <!-- Basic Info -->
              <div class="col-span-6 sm:col-span-4 space-y-4">
                <div class="grid grid-cols-6 gap-4">
                  <div class="col-span-6 sm:col-span-3">
                    <label class="block text-sm font-medium text-gray-700">First Name</label>
                    <input type="text" value="{{request.user.first_name}}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                  </div>
                  <div class="col-span-6 sm:col-span-3">
                    <label class="block text-sm font-medium text-gray-700">Last Name</label>
                    <input type="text" value="{{request.user.last_name}}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Email</label>
                  <input type="email" value="{{request.user.email}}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                </div>
              </div>
            </div>
          </section>

          <!-- Security Section -->
          <section class="bg-white pt-6 border-t">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Security</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Two-Factor Authentication</h4>
                  <p class="text-sm text-gray-500">Add an extra layer of security to your account</p>
                </div>
                <button class="px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Enable</button>
              </div>
              <div class="flex items-center justify-between py-4">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Active Sessions</h4>
                  <p class="text-sm text-gray-500">Manage your active sessions across devices</p>
                </div>
                <button class="text-sm text-blue-600 hover:text-blue-700">View all</button>
              </div>
            </div>
          </section>
        </div>
      </div>

      <!-- Billing Settings -->
      <div id="billing" class="tab-content hidden">
        <div class="space-y-6">
          <!-- Payment Methods -->
          <section class="bg-white">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Payment Methods</h3>
            <div class="space-y-4">
              <!-- Existing Card -->
              <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div class="flex items-center space-x-3">
                  <i class="fab fa-cc-visa text-2xl text-blue-600"></i>
                  <div>
                    <p class="text-sm font-medium text-gray-900">Visa ending in 4242</p>
                    <p class="text-sm text-gray-500">Expires 12/24</p>
                  </div>
                </div>
                <button class="text-sm text-red-600 hover:text-red-700">Remove</button>
              </div>
              <button class="flex items-center text-sm text-blue-600 hover:text-blue-700">
                <i class="fas fa-plus mr-2"></i>Add new payment method
              </button>
            </div>
          </section>

          <!-- Billing History -->
          <section class="bg-white pt-6 border-t">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-medium text-gray-900">Billing History</h3>
              <button class="text-sm text-blue-600 hover:text-blue-700">Download all</button>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Invoice</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Aug 1, 2023</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$29.00</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full">Paid</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-blue-600 hover:text-blue-700">
                      <a href="#">Download</a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>
      </div>

      <!-- Notifications Settings -->
      <div id="notifications" class="tab-content hidden">
        <div class="space-y-6">
          <!-- Email Notifications -->
          <section class="bg-white">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Email Notifications</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Subscription Renewals</h4>
                  <p class="text-sm text-gray-500">Get notified before subscriptions renew</p>
                </div>
                <div class="flex items-center">
                  <select class="mr-4 text-sm border-gray-300 rounded-md">
                    <option>7 days before</option>
                    <option>3 days before</option>
                    <option>1 day before</option>
                  </select>
                  <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
              
              <!-- Additional notification settings -->
              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Payment Failures</h4>
                  <p class="text-sm text-gray-500">Get notified when a payment fails</p>
                </div>
                <label class="switch">
                  <input type="checkbox" checked>
                  <span class="slider round"></span>
                </label>
              </div>
              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">New Features</h4>
                  <p class="text-sm text-gray-500">Get notified about new features and updates</p>
                </div>
                <label class="switch">
                  <input type="checkbox">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
          </section>
          <!-- SMTP Settings -->
          <section class="bg-white mt-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">SMTP Settings</h3>
            <div class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">SMTP Host</label>
                  <input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" value="{{smtp_settings.host}}" placeholder="smtp.example.com">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">SMTP Port</label>
                  <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" value="{{smtp_settings.port}}" placeholder="587">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Username</label>
                  <input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" value="{{smtp_settings.email}}" placeholder="user@example.com">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Password</label>
                  <input type="password" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" value="{{smtp_settings.password}}" placeholder="••••••••">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Encryption</label>
                  <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    <option value="tls">TLS</option>
                    <option value="ssl">SSL</option>
                    <option value="none">None</option>
                  </select>
                </div>
              </div>

              <div class="pt-4">
                <button id="save-smtp-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Save SMTP Settings</button>
                <button class="ml-4 text-blue-600 underline hover:text-blue-800">Send Test Email</button>
              </div>
            </div>
          </section>
        </div>
      </div>

      <!-- Integrations Settings -->
      <div id="integrations" class="tab-content hidden">
        <div class="space-y-6">
          <!-- Payment Integrations -->
          <section class="bg-white">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Payment Integrations</h3>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/stripe.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">Stripe</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Process payments and manage subscriptions</p>
              </div>
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/paypal.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">PayPal</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Accept payments via PayPal</p>
              </div>

              <!-- Square -->
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/squareup.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">Square</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Process in-person and online payments</p>
              </div>

              <!-- Razorpay -->
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/razorpay.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">Razorpay</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Accept payments in multiple currencies</p>
              </div>
            </div>
          </section>

          <!-- Calendar Integrations -->
          <section class="bg-white pt-6 border-t">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Calendar Integrations</h3>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <!-- Google Calendar -->
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/google.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">Google Calendar</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Sync renewal dates and payment deadlines</p>
              </div>

              <!-- Outlook Calendar -->
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/microsoft.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">Outlook Calendar</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Sync with Microsoft Outlook calendar</p>
              </div>
            </div>
          </section>

          <!-- Accounting Integrations -->
          <section class="bg-white pt-6 border-t">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Accounting Integrations</h3>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <!-- QuickBooks -->
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/quickbooks.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">QuickBooks</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Sync expenses and invoices</p>
              </div>

              <!-- Xero -->
              <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img src="https://logo.clearbit.com/xero.com" class="h-8 w-8 rounded">
                    <h4 class="text-sm font-medium text-gray-900">Xero</h4>
                  </div>
                  <button class="px-3 py-1 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">Connect</button>
                </div>
                <p class="text-sm text-gray-500">Sync with Xero accounting</p>
              </div>
            </div>
          </section>
        </div>
      </div>

      <!-- Advanced Settings -->
      <div id="advanced" class="tab-content hidden">
        <div class="space-y-6">
          <!-- API Access -->
          <section class="bg-white">
            <h3 class="text-lg font-medium text-gray-900 mb-4">API Access</h3>
            <div class="space-y-4">
              <div class="p-4 bg-gray-50 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <h4 class="text-sm font-medium text-gray-900">API Key</h4>
                  <button class="text-sm text-blue-600 hover:text-blue-700">Generate New Key</button>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="password" value="sk_test_123456789" class="flex-1 text-sm bg-white border-gray-300 rounded-md" readonly>
                  <button class="p-2 text-gray-500 hover:text-gray-700">
                    <i class="far fa-copy"></i>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- Customization -->
          <section class="bg-white pt-6 border-t">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Customization</h3>
            <div class="space-y-4">
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div>
                  <label class="block text-sm font-medium text-gray-700">Default Currency</label>
                  <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                    <option>USD ($)</option>
                    <option>EUR (€)</option>
                    <option>GBP (£)</option>
                    <option>JPY (¥)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Date Format</label>
                  <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                    <option>MM/DD/YYYY</option>
                    <option>DD/MM/YYYY</option>
                    <option>YYYY-MM-DD</option>
                  </select>
                </div>
              </div>
            </div>
          </section>

          <!-- Data Management -->
          <section class="bg-white pt-6 border-t">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Data Management</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Export Data</h4>
                  <p class="text-sm text-gray-500">Download all your subscription data</p>
                </div>
                <button class="px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">
                  Export
                </button>
              </div>

              <!-- Import Data -->
              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Import Data</h4>
                  <p class="text-sm text-gray-500">Import subscriptions from CSV</p>
                </div>
                <button class="px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100">
                  Import
                </button>
              </div>

              <!-- Data Backup -->
              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Automatic Backups</h4>
                  <p class="text-sm text-gray-500">Backup your data automatically</p>
                </div>
                <label class="switch">
                  <input type="checkbox" checked>
                  <span class="slider round"></span>
                </label>
              </div>

              <div class="flex items-center justify-between py-4 border-b">
                <div>
                  <h4 class="text-sm font-medium text-gray-900">Delete Account</h4>
                  <p class="text-sm text-gray-500">Permanently delete your account and data</p>
                </div>
                <button class="px-4 py-2 text-sm font-medium text-red-600 bg-red-50 rounded-md hover:bg-red-100">
                  Delete
                </button>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Tab switching functionality
  const tabButtons = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');
  
  function switchTab(tabId) {
    // Deactivate all tabs
    tabButtons.forEach(btn => {
      btn.classList.remove('border-blue-500', 'text-blue-600');
      btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
    });
    
    // Hide all content
    tabContents.forEach(content => {
      content.classList.add('hidden');
    });
    
    // Activate current tab
    const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
    if (activeButton) {
      activeButton.classList.add('border-blue-500', 'text-blue-600');
      activeButton.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
      
      // Show current content
      const currentContent = document.getElementById(tabId);
      currentContent.classList.remove('hidden');
      
      // Update URL hash
      window.location.hash = tabId;
    }
  }
  
  // Handle tab button clicks
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
      const tabId = button.getAttribute('data-tab');
      switchTab(tabId);
    });
  });
  
  // Handle page load and browser navigation
  window.addEventListener('load', () => {
    const hash = window.location.hash.replace('#', '');
    if (hash && document.getElementById(hash)) {
      switchTab(hash);
    } else {
      switchTab('account'); // Default tab
    }
  });
  
  window.addEventListener('hashchange', () => {
    const hash = window.location.hash.replace('#', '');
    if (hash && document.getElementById(hash)) {
      switchTab(hash);
    }
  });

  // Form submission feedback
  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', (e) => {
      // Allow forms with action attribute to submit normally
      if (form.getAttribute('action')) {
        return;
      }
      
      // For forms without action, prevent default and show feedback
      e.preventDefault();
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.textContent;
      
      // Change button state
      button.innerHTML = '<i class="fas fa-check mr-2"></i>Saved';
      button.classList.add('bg-green-600');
      button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
      
      // Revert button state after 2 seconds
      setTimeout(() => {
        button.textContent = originalText;
        button.classList.remove('bg-green-600');
        button.classList.add('bg-blue-600', 'hover:bg-blue-700');
      }, 2000);
    });
  });

  document.addEventListener('DOMContentLoaded', function () {
  const saveBtn = document.getElementById('save-smtp-btn');

  if (saveBtn) {
    saveBtn.addEventListener('click', function () {
      const smtpHost = document.querySelector('input[placeholder="smtp.example.com"]').value;
      const smtpPort = document.querySelector('input[placeholder="587"]').value;
      const username = document.querySelector('input[placeholder="user@example.com"]').value;
      const password = document.querySelector('input[placeholder="••••••••"]').value;
      const encryption = document.querySelector('select').value;

      const smtpData = {
        host: smtpHost,
        port: smtpPort,
        email: username,
        password: password,
        encryption: encryption
      };

      fetch('/api/save-smtp-settings/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCSRFToken() // Optional: if you're using Django or similar
        },
        body: JSON.stringify(smtpData)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        alert('SMTP settings saved successfully!');
        console.log(data);
      })
      .catch(error => {
        console.error('Error saving SMTP settings:', error);
        alert('Failed to save SMTP settings.');
      });
    });
  }

  function getCSRFToken() {
    const name = 'csrftoken';
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
      const trimmed = cookie.trim();
      if (trimmed.startsWith(name + '=')) {
        return trimmed.substring(name.length + 1);
      }
    }
    return '';
  }
});
</script>
{% endblock %}